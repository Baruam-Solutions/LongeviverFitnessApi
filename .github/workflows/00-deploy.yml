name: Deploy completo

on:
  push:
    branches:
      - main
      - feature/BARUAM-24

permissions:
  id-token: write
  contents: read

jobs:
  # Job para definir o ambiente e carregar variáveis/secrets correspondentes
  setup-environment:
    runs-on: ubuntu-latest
    environment: dev-mateus
    outputs:
      PROJECT_ID: ${{ env.PROJECT_ID }}
      PROJECT_NUMBER: ${{ env.PROJECT_NUMBER }}
      PROJECT_REGION: ${{ env.PROJECT_REGION }}
      PROJECT_ZONE: ${{ env.PROJECT_ZONE }}
      BOOTSTRAP_STATE_BUCKET_NAME: ${{ env.BOOTSTRAP_STATE_BUCKET_NAME }}
      ARTIFACT_REGISTRY_REPOSITORY_NAME: ${{ env.ARTIFACT_REGISTRY_REPOSITORY_NAME }}
      GITHUB_REPO: ${{ env.GITHUB_REPOSITORY }}
      GITHUB_POOL: ${{ env.GIT_POOL }}
      GITHUB_PROVIDER: ${{ env.GIT_PROVIDER }}
    steps:
      - name: Debug - List all environment variables
        run: |
          echo "--- Listing all environment variables for this job ---"
          env # Comando 'env' lista todas as variáveis de ambiente
          echo "-----------------------------------------------------"
          echo "Setting up environment: ${{ github.event.inputs.environment }}"
          echo "Project ID (from env): $PROJECT_ID"
          echo "Project Number (from env): $PROJECT_NUMBER"
          echo "GIT_POOL (from env): $GIT_POOL"
          echo "GIT_PROVIDER (from env): $GIT_PROVIDER"
          echo "GIT_REPO (from env): $GITHUB_REPOSITORY"
          echo "-----------------------------------------------------"